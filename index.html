<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Box Motors — Controle de Gastos</title>
<style>
  :root{
    --bg:#0b0b0b;
    --card:#121212;
    --accent:#c8102e;
    --muted:#9aa0a6;
    --ok:#16a34a;
    --text: #ffffff; /* cor principal do texto nos campos */
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter, Arial, sans-serif;
    background:linear-gradient(180deg,#0f1720 0%, #07101a 100%);
    color:#fff;
    -webkit-font-smoothing:antialiased;
    padding:18px;
  }
  header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:14px}
  header h1{font-size:18px;margin:0}
  .container{max-width:980px;margin:0 auto}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
  .card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(0,0,0,.5)}
  label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
  input[type="text"], input[type="number"], input[type="date"], select, textarea{
    width:100%;
    padding:10px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,.04);
    background: rgba(255,255,255,0.02); /* leve contraste para facilitar leitura */
    color: var(--text);
    margin-bottom:10px;
    outline: none;
  }
  /* placeholder e opções visíveis */
  input::placeholder, textarea::placeholder {
    color: rgba(255,255,255,0.6);
  }
  select option {
    color: var(--text);
    background: var(--card);
  }
  /* força aparência consistente do select e mantém texto visível */
  select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-image: linear-gradient(45deg, transparent 50%, var(--muted) 50%), linear-gradient(135deg, var(--muted) 50%, transparent 50%);
    background-position: calc(100% - 18px) calc(1em + 2px), calc(100% - 13px) calc(1em + 2px);
    background-size: 6px 6px, 6px 6px;
    background-repeat: no-repeat;
    padding-right: 34px; /* espaço para o ícone */
  }
  /* suporte Edge/IE: mostrar texto branco mesmo se opção tiver estilo nativo */
  select:focus, input:focus, textarea:focus { border-color: rgba(255,255,255,0.12); }

  .row{display:flex;gap:8px}
  .row .col{flex:1}
  button{padding:10px 12px;border-radius:8px;border:none;background:var(--accent);color:#fff;cursor:pointer}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,.06)}
  .list{max-height:360px;overflow:auto;margin-top:10px}
  .tx{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;margin-bottom:8px;background:linear-gradient(180deg, rgba(255,255,255,.02), transparent)}
  .tx .meta{display:flex;gap:10px;align-items:center}
  .tx .amount{font-weight:700}
  .income{color:var(--ok)}
  .expense{color:#ffb86b}
  .small{font-size:12px;color:var(--muted)}
  .summary{display:flex;gap:10px;margin-bottom:8px}
  .summary .s{flex:1;padding:10px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,.02), transparent)}
  canvas{width:100%;height:200px;border-radius:8px;background:transparent}
  footer{margin-top:18px;color:var(--muted);font-size:12px;text-align:center}

  /* Branding / comercial */
  .badge-demo{
    display:inline-block;background:#ffb86b;color:#111;padding:6px 8px;border-radius:6px;font-weight:700;margin-right:8px;font-size:12px;
  }
  /* Tema claro: sobrescreve variáveis e cores quando body[data-theme="light"] */
  body[data-theme="light"]{
    --bg: #ffffff;
    --card: #f6f6f6;
    --accent: #c8102e;
    --muted: #6b7280;
    --ok: #0f766e;
    --text: #0b1220; /* texto nos campos no tema claro */
    color: #0b1220;
    background: linear-gradient(180deg,#ffffff 0%, #f7f7f7 100%);
  }
  /* ajuste simples para botões ghost no tema claro */
  body[data-theme="light"] button.ghost{ border-color: rgba(0,0,0,0.08); color:#0b1220; }
  #licenseRow{display:inline-flex;gap:8px;align-items:center}
  #licenseKey{padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,.06);background:transparent;color:#fff}
  #buyBtn{background:#16a34a;padding:8px 10px;border-radius:8px;color:#fff;border:none;cursor:pointer}
  #watermark-demo{
    position:fixed;right:10px;bottom:10px;padding:8px 12px;background:rgba(200,20,20,0.12);color:#fff;border-radius:8px;font-size:12px;backdrop-filter: blur(4px);
  }

  @media(max-width:900px){.grid{grid-template-columns:1fr;}.card{padding:12px}}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>Box Motors — Controle de Gastos</h1>
    <div>
      <span id="headerCommercial">
        <span id="demoBadge" class="badge-demo">DEMO</span>
        <button id="buyBtn" onclick="openPurchase()">Comprar</button>
        <span id="licenseRow">
          <input id="licenseKey" placeholder="Chave de licença (cole aqui)" />
          <button onclick="applyLicense()">Ativar</button>
          <button id="revokeLicenseBtn" class="ghost" onclick="revokeLicense()" style="margin-left:6px;display:none;">Resetar licença</button>
        </span>
      </span>
      <button id="exportCsv">Exportar CSV</button>
      <button id="resetAll" class="ghost">Resetar dados</button>
      <button id="themeToggle" class="ghost" onclick="toggleTheme()" title="Alternar tema">Tema</button>
    </div>
  </header>

  <main class="grid">
    <section>
      <div class="card">
        <div class="summary">
          <div class="s">
            <div class="small">Saldo Total</div>
            <div id="saldo" style="font-size:20px;font-weight:700">R$ 0,00</div>
          </div>
          <div class="s">
            <div class="small">Receitas</div>
            <div id="receitas" style="font-size:18px;color:#7ee787">R$ 0,00</div>
          </div>
          <div class="s">
            <div class="small">Despesas</div>
            <div id="despesas" style="font-size:18px;color:#ffb86b">R$ 0,00</div>
          </div>
        </div>

        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px">
          <select id="filtroCategoria"><option value="">Todas categorias</option></select>
          <input type="date" id="filtroData" style="max-width:200px">
          <button id="aplicarFiltro" class="ghost">Aplicar</button>
          <button id="limparFiltro" class="ghost">Limpar</button>
        </div>

        <div class="card" style="margin-bottom:12px">
          <canvas id="chart" width="600" height="200"></canvas>
        </div>

        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:700">Transações</div>
            <div class="small">Clique em editar para alterar</div>
          </div>
          <div id="tx-list" class="list" aria-live="polite"></div>
        </div>
      </div>
    </section>

    <aside>
      <div class="card" style="margin-bottom:12px">
        <div style="font-weight:700;margin-bottom:8px">Adicionar transação</div>
        <label>Tipo</label>
        <select id="tipo">
          <option value="expense">Despesa</option>
          <option value="income">Receita</option>
        </select>

        <label>Categoria</label>
        <select id="categoria"></select>
        <div style="display:flex;gap:6px;margin-top:6px">
          <button class="ghost" onclick="openCategories()">Gerenciar categorias</button>
        </div>

        <label>Descrição</label>
        <input type="text" id="descricao" placeholder="Ex: Troca de óleo">

        <div class="row">
          <div class="col">
            <label>Valor (R$)</label>
            <input type="number" id="valor" step="0.01" placeholder="0.00">
          </div>
          <div class="col">
            <label>Data</label>
            <input type="date" id="data">
          </div>
        </div>

        <div style="display:flex;gap:8px;margin-top:6px">
          <button id="addTx">Adicionar</button>
          <button id="updateTx" style="display:none" class="ghost">Salvar edição</button>
        </div>
        <input type="hidden" id="editingId" value="">
      </div>
    </aside>
  </main>

  <footer>
    Sistema local (dados salvos no navegador). Para backup use "Exportar CSV".
  </footer>
</div>

<div id="watermark-demo" style="display:none;">Versão DEMO — comprar para desbloquear</div>

<div id="categories-page" style="display:none; max-width:980px; margin:18px auto;">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="font-weight:700">Gerenciar Categorias</div>
      <div>
        <button class="ghost" onclick="closeCategories()">Voltar</button>
      </div>
    </div>

    <div style="margin-bottom:10px">
      <label>Adicionar categoria</label>
      <div style="display:flex;gap:8px">
        <input id="pageNewCategory" placeholder="Nome da nova categoria" style="flex:1;padding:8px;border-radius:6px;background:transparent;color:#fff;border:1px solid rgba(255,255,255,.04)">
        <button onclick="addCategoryFromPage()">Adicionar</button>
      </div>
    </div>

    <div>
      <div style="font-weight:700;margin-bottom:8px">Categorias cadastradas</div>
      <div id="categories-list"></div>
    </div>
  </div>
</div>

<script>
/* ======== MODELO E ARMAZENAMENTO ======== */
const STORAGE_KEY = 'boxmotors_gastos_v1';
let state = {
  tx: [], // {id, tipo: 'expense'|'income', categoria, descricao, valor (number), data (YYYY-MM-DD)}
  categories: [] // lista de categorias personalizáveis
};
loadState();

function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw) state = JSON.parse(raw);
  }catch(e){ console.error('Erro ao carregar estado', e); }
}

/* ======== DEFAULT CATEGORIES ======== */
const DEFAULT_CATEGORIES = ['Combustível','Peças','Serviços','Marketing','Outros'];
function ensureDefaultCategories(){
  if(!Array.isArray(state.categories) || state.categories.length===0){
    state.categories = DEFAULT_CATEGORIES.slice();
    saveState();
  } else {
    // make sure defaults at least include 'Outros'
    if(!state.categories.includes('Outros')) state.categories.push('Outros');
  }
}

/* ======== UTIL ======== */
function uid(){ return Date.now().toString(36)+Math.random().toString(36).slice(2,8); }
function fmt(v){ return 'R$ '+Number(v).toFixed(2).replace('.',','); }
function parseNum(v){ return Number(String(v).replace(',','.'))||0; }

/* ======== RENDER ======== */
const txListEl = document.getElementById('tx-list');
const saldoEl = document.getElementById('saldo');
const receitasEl = document.getElementById('receitas');
const despesasEl = document.getElementById('despesas');
const filtroCategoria = document.getElementById('filtroCategoria');
const filtroData = document.getElementById('filtroData');

function renderCategoriesToSelects(){
  ensureDefaultCategories();
  const cats = state.categories.slice();
  // populate categoria select (main input), filtro and budget select
  document.getElementById('categoria').innerHTML = cats.map(c=>`<option value="${c}">${c}</option>`).join('');
  filtroCategoria.innerHTML = '<option value="">Todas categorias</option>' + cats.map(c=>`<option value="${c}">${c}</option>`).join('');
}

function render(){
  // filters
  const catFilter = filtroCategoria.value;
  const dateFilter = filtroData.value;

  // list
  txListEl.innerHTML = '';
  const list = state.tx
    .filter(t=>{
      if(catFilter && t.categoria!==catFilter) return false;
      if(dateFilter && t.data!==dateFilter) return false;
      return true;
    })
    .sort((a,b)=> b.data.localeCompare(a.data) || b.id.localeCompare(a.id));

  for(const t of list){
    const div = document.createElement('div');
    div.className='tx';
    div.innerHTML = `<div class="meta">
        <div style="min-width:110px"><div style="font-weight:600">${t.categoria}</div><div class="small">${t.data}</div></div>
        <div style="max-width:220px"><div style="font-weight:700">${t.descricao||'—'}</div><div class="small">${t.id}</div></div>
      </div>
      <div style="text-align:right">
        <div class="amount ${t.tipo==='income'?'income':'expense'}">${t.tipo==='income'?'+':'-'} ${fmt(t.valor)}</div>
        <div style="margin-top:6px;display:flex;gap:6px;justify-content:flex-end">
          <button class="ghost" onclick="editTx('${t.id}')">Editar</button>
          <button class="ghost" onclick="deleteTx('${t.id}')">Remover</button>
        </div>
      </div>`;
    txListEl.appendChild(div);
  }

  // totals
  const totalIncome = state.tx.filter(t=>t.tipo==='income').reduce((s,x)=>s+x.valor,0);
  const totalExpense = state.tx.filter(t=>t.tipo==='expense').reduce((s,x)=>s+x.valor,0);
  saldoEl.textContent = fmt(totalIncome - totalExpense);
  receitasEl.textContent = fmt(totalIncome);
  despesasEl.textContent = fmt(totalExpense);

  renderCategoriesToSelects();
  renderChart();
  saveState();
}

/* ======== CRUD TRANSAÇÕES ======== */
document.getElementById('addTx').addEventListener('click', ()=>{
  // 1. Verifica Demo antes de qualquer coisa
  if(!demoCanAddTx()) return; 

  const tipo = document.getElementById('tipo').value;
  const categoria = document.getElementById('categoria').value;
  const descricao = document.getElementById('descricao').value.trim();
  const valor = parseNum(document.getElementById('valor').value);
  const data = document.getElementById('data').value || (new Date()).toISOString().slice(0,10);

  if(!valor || valor<=0){ alert('Valor inválido'); return; }
  if(!categoria){ alert('Escolha uma categoria'); return; }

  const tx = { id: uid(), tipo, categoria, descricao, valor: Number(valor), data };
  state.tx.push(tx);
  document.getElementById('descricao').value=''; document.getElementById('valor').value=''; document.getElementById('data').value='';
  
  // check budgets
  checkBudgetsAfterTx(tx);
  render();
});

function editTx(id){
  const tx = state.tx.find(t=>t.id===id);
  if(!tx) return;
  document.getElementById('tipo').value = tx.tipo;
  document.getElementById('categoria').value = tx.categoria;
  document.getElementById('descricao').value = tx.descricao;
  document.getElementById('valor').value = tx.valor;
  document.getElementById('data').value = tx.data;
  document.getElementById('editingId').value = id;
  document.getElementById('addTx').style.display='none';
  document.getElementById('updateTx').style.display='inline-block';
}

document.getElementById('updateTx').addEventListener('click', ()=>{
  const id = document.getElementById('editingId').value;
  const tx = state.tx.find(t=>t.id===id);
  if(!tx) return;
  tx.tipo = document.getElementById('tipo').value;
  tx.categoria = document.getElementById('categoria').value;
  tx.descricao = document.getElementById('descricao').value.trim();
  tx.valor = parseNum(document.getElementById('valor').value);
  tx.data = document.getElementById('data').value || tx.data;
  document.getElementById('editingId').value='';
  document.getElementById('addTx').style.display='inline-block';
  document.getElementById('updateTx').style.display='none';
  render();
});

function deleteTx(id){
  if(!confirm('Remover esta transação?')) return;
  state.tx = state.tx.filter(t=>t.id!==id);
  render();
}

/* ======== FILTROS ======== */
document.getElementById('aplicarFiltro').addEventListener('click', render);
document.getElementById('limparFiltro').addEventListener('click', ()=>{
  filtroCategoria.value=''; filtroData.value='';
  render();
});

/* ======== CSV / RESET ======== */
document.getElementById('exportCsv').addEventListener('click', ()=>{
  if(!isLicensed()){ alert('Exportar CSV disponível apenas na versão completa.'); return; }
  const rows = [['id','tipo','categoria','descricao','valor','data']];
  state.tx.forEach(t=> rows.push([t.id,t.tipo,t.categoria,t.descricao, t.valor.toFixed(2), t.data]));
  const csv = rows.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download = 'boxmotors_transacoes.csv'; a.click();
  URL.revokeObjectURL(url);
});

document.getElementById('resetAll').addEventListener('click', ()=>{
  if(!isLicensed()){ alert('Resetar dados disponível apenas na versão completa.'); return; }
  if(!confirm('Apagar todos os dados salvos no navegador? Esta ação não pode ser revertida.')) return;
  state = {tx:[], categories: state.categories || []};
  ensureDefaultCategories();
  saveState();
  render();
});

/* ======== CHART: gasto por categoria (canvas) ======== */
function renderChart(){
  const canvas = document.getElementById('chart');
  const ctx = canvas.getContext('2d');
  // clear
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // compute sums by category (expenses only)
  const sums = {};
  state.tx.filter(t=>t.tipo==='expense').forEach(t=> sums[t.categoria]=(sums[t.categoria]||0)+t.valor);
  const entries = Object.entries(sums).sort((a,b)=>b[1]-a[1]);
  if(entries.length===0){
    // placeholder
    ctx.fillStyle = 'rgba(255,255,255,0.04)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = '#9aa0a6';
    ctx.font = '14px Arial';
    ctx.fillText('Sem despesas para exibir', 12, 24);
    return;
  }
  const total = entries.reduce((s,e)=>s+e[1],0);
  // draw horizontal bar chart
  const padding = 12; const barAreaWidth = canvas.width - padding*2; const barHeight = Math.max(18, Math.floor((canvas.height - padding*2)/entries.length) - 6);
  ctx.font = '12px Arial';
  let y = padding;
  entries.forEach(([cat, val],i)=>{
    const pct = val/total;
    const w = Math.round(barAreaWidth * pct);
    // color (deterministic)
    const hue = (i*47)%360;
    ctx.fillStyle = `hsl(${hue} 70% 55% / 0.9)`;
    ctx.fillRect(padding, y, w, barHeight);
    ctx.fillStyle = '#fff';
    ctx.fillText(`${cat} — ${fmt(val)} (${Math.round(pct*100)}%)`, padding+6, y+barHeight-6);
    y += barHeight + 8;
  });
}

/* =======================
   COMERCIAL / LICENÇA
   ======================= */
// Demo limit: máximo de transações que podem ser adicionadas na versão demo
const DEMO_MAX_TX = 3;

// Exemplo de chaves válidas (substitua por verificação real em servidor ao vender)
const VALID_LICENSE_KEYS = [
  'BOXMOTORS-LIC-2025-EXAMPLE',
  'BOXMOTORS-PRO-ABC123'
];

function isLicensed(){
  return !!localStorage.getItem('boxmotors_license_key');
}

function applyLicense(){
  const key = document.getElementById('licenseKey').value.trim();
  if(!key){ alert('Cole a chave de licença.'); return; }
  // valida localmente (só exemplo). Para produção faça verificação server-side.
  if(VALID_LICENSE_KEYS.includes(key)){
    localStorage.setItem('boxmotors_license_key', key);
    alert('Licença ativada. Obrigado pela compra!');
    updateCommercialUI();
    render(); // refresh UI to enable features
  } else {
    alert('Chave inválida. Verifique a cópia ou contate suporte.');
  }
}

function openPurchase(){
  // link para página de compra — substitua pela sua página real de venda
  window.open('https://seusite.com/comprar-boxmotors', '_blank');
}

function revokeLicense(){
  localStorage.removeItem('boxmotors_license_key');
  updateCommercialUI();
  alert('Licença resetada localmente.');
}

/* Atualiza elementos da interface conforme estado licença/demo */
function updateCommercialUI(){
  const licensed = isLicensed();
  document.getElementById('demoBadge').style.display = licensed ? 'none' : 'inline-block';
  document.getElementById('watermark-demo').style.display = licensed ? 'none' : 'block';
  // bloquear export/reset em demo
  document.getElementById('exportCsv').disabled = !licensed;
  document.getElementById('resetAll').disabled = !licensed;
  // esconder license input se licenciado
  document.getElementById('licenseKey').style.display = licensed ? 'none' : 'inline-block';
  // mostrar botão de revogar licença apenas quando licenciado
  document.getElementById('revokeLicenseBtn').style.display = licensed ? 'inline-block' : 'none';
  // change buy button text
  document.getElementById('buyBtn').textContent = licensed ? 'Licenciado' : 'Comprar';
}

/* Enforce demo limits before adding a transaction */
function demoCanAddTx(){
  if(isLicensed()) return true;
  const count = state.tx.length;
  if(count >= DEMO_MAX_TX){
    if(confirm(`Você atingiu o limite de ${DEMO_MAX_TX} transações na versão DEMO.\nDeseja comprar a versão completa agora?`)) openPurchase();
    return false;
  }
  return true;
}

/* [CORREÇÃO] O bloco duplicado que causava o erro "Valor Inválido" foi removido daqui */

/* ======== CATEGORIAS: CRUD (subpage helpers) ======== */
/* renderiza a lista dentro da subpágina */
function renderCategoriesPage(){
  ensureDefaultCategories();
  const container = document.getElementById('categories-list');
  container.innerHTML = '';
  if(!state.categories || state.categories.length===0){
    container.innerHTML = '<div class="small">Nenhuma categoria cadastrada.</div>';
    return;
  }
  state.categories.forEach((cat, idx) => {
    const row = document.createElement('div');
    row.style.display = 'flex';
    row.style.justifyContent = 'space-between';
    row.style.alignItems = 'center';
    row.style.padding = '8px';
    row.style.marginBottom = '6px';
    row.style.borderRadius = '6px';
    row.style.background = 'linear-gradient(180deg, rgba(255,255,255,0.01), transparent)';
    row.innerHTML = `<div style="font-weight:600">${cat}</div>
      <div style="display:flex;gap:6px">
        <button class="ghost" onclick="editCategoryFromPage(${idx})">Editar</button>
        <button class="ghost" onclick="deleteCategoryFromPage(${idx})">Remover</button>
      </div>`;
    container.appendChild(row);
  });
}

/* abrir a subpágina */
function openCategories(){
  // esconder main grid e mostrar categories-page
  document.querySelector('main').style.display = 'none';
  document.getElementById('categories-page').style.display = 'block';
  renderCategoriesPage();
}

/* fechar a subpágina */
function closeCategories(){
  document.getElementById('categories-page').style.display = 'none';
  document.querySelector('main').style.display = 'grid';
  // atualizar selects e UI principal
  renderCategoriesToSelects();
  render();
}

/* adicionar categoria a partir da subpágina */
function addCategoryFromPage(){
  const name = document.getElementById('pageNewCategory').value.trim();
  if(!name) return alert('Informe o nome da categoria.');
  ensureDefaultCategories();
  if(state.categories.includes(name)) return alert('Categoria já existe.');
  state.categories.push(name);
  document.getElementById('pageNewCategory').value = '';
  saveState();
  renderCategoriesPage();
  renderCategoriesToSelects();
}

/* editar categoria pela subpágina (por índice) */
function editCategoryFromPage(index){
  const oldName = state.categories[index];
  if(!oldName) return;
  const newName = prompt('Novo nome para a categoria:', oldName);
  if(newName === null) return;
  const nm = newName.trim();
  if(!nm) return alert('Nome inválido.');
  if(state.categories.includes(nm) && nm !== oldName) return alert('Já existe uma categoria com esse nome.');
  state.categories[index] = nm;
  // atualizar transações que usavam o nome antigo
  state.tx.forEach(t => { if(t.categoria === oldName) t.categoria = nm; });
  saveState();
  renderCategoriesPage();
  renderCategoriesToSelects();
  render();
}

/* remover categoria pela subpágina (por índice) */
function deleteCategoryFromPage(index){
  const name = state.categories[index];
  if(!name) return;
  if(!confirm(`Remover categoria "${name}"? Transações desta categoria serão reatribuídas para "Outros".`)) return;
  // remover
  state.categories.splice(index,1);
  // garantir fallback
  ensureDefaultCategories();
  const fallback = state.categories.includes('Outros') ? 'Outros' : (state.categories[0] || 'Outros');
  if(!state.categories.includes('Outros')) state.categories.push('Outros');
  state.tx.forEach(t => { if(t.categoria === name) t.categoria = fallback; });
  saveState();
  renderCategoriesPage();
  renderCategoriesToSelects();
  render();
}

/* ======== INIT ======== */
// populate category select initial options (keeps custom ones after transactions)
(function init(){
  // set default date to today for quick input
  document.getElementById('data').value = new Date().toISOString().slice(0,10);
  // ensure categories exist and populate category selects
  ensureDefaultCategories();
  renderCategoriesToSelects();
  render();
})();

/* ======== TEMA (Dark / Light) ======== */
const THEME_KEY = 'boxmotors_theme';
function applyTheme(theme){
  if(theme) localStorage.setItem(THEME_KEY, theme);
  const stored = localStorage.getItem(THEME_KEY) || 'dark';
  if(stored === 'light') document.body.setAttribute('data-theme','light');
  else document.body.removeAttribute('data-theme');
  document.getElementById('themeToggle').textContent = stored === 'light' ? 'Tema: Claro' : 'Tema: Escuro';
}
function toggleTheme(){
  const current = localStorage.getItem(THEME_KEY) || 'dark';
  const next = current === 'light' ? 'dark' : 'light';
  applyTheme(next);
}
// aplicar tema ao carregar
applyTheme();

/* ======== HELPERS EXTRAS ======== */
// Placeholder para evitar erro no console caso a funcionalidade de orçamento seja expandida no futuro
function checkBudgetsAfterTx(tx) {
    // console.log('Transação processada. Verificação de orçamento pendente.');
}
</script>
</body>

</html>
